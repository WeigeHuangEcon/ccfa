<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Continuous Counterfactual Analysis • ccfa</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Continuous Counterfactual Analysis">
<meta property="og:description" content="Contains methods for computing counterfactuals with a continuous treatment variable as in Callaway and Huang (2020) &lt;https://doi.org/10.1111/obes.12355&gt;.  In particular, the package can be used to calculate the expected value, the variance, the interquantile range, the fraction of observations below or above a particular cutoff, or other user-supplied functions of an outcome of interest conditional on a continuous treatment.  The package can also be used for computing these same functionals after adjusting for differences in covariates at different values of the treatment.  Further, one can use the package to conduct uniform inference for each parameter of interest across all values of the treatment, uniformly test whether adjusting for covariates makes a difference at any value of the treatment, and test whether a parameter of interest is different from its average value at an value of the treatment.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">ccfa</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="ccfa" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#ccfa" class="anchor"></a>ccfa</h1></div>
<p>The <code>ccfa</code> package contains methods for computing counterfactuals with a continuous treatment variable. In particular, the package can be used to calculate the expected value, the variance, the interquantile range, the fraction of observations below or above a particular cutoff, or other user-supplied functions of an outcome of interest conditional on a continuous treatment. The package can also be used for computing these same functionals after adjusting for differences in covariates at different values of the treatment. Further, one can use the package to conduct uniform inference for each parameter of interest across all values of the treatment, uniformly test whether adjusting for covariates makes a difference at any value of the treatment, and test whether a parameter of interest is different from its average value at an value of the treatment.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install <code>ccfa</code> from github with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"WeigeHuangEcon/ccfa"</span><span class="op">)</span>
<span class="co">#&gt; Skipping install of 'ccfa' from a github remote, the SHA1 (356e921f) has not changed since last install.</span>
<span class="co">#&gt;   Use `force = TRUE` to force installation</span></code></pre></div>
<p>or from CRAN using</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"ccfa"</span><span class="op">)</span></code></pre></div>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p>The following example shows how to estimate the counterfactual distribution of child’s income as a function of parent’s income, as well as some additional parameters that depend on this distribution.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ccfa</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'ccfa'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     IQR</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">igm</span><span class="op">)</span>
<span class="va">tvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">12</span>,length.out<span class="op">=</span><span class="fl">10</span><span class="op">)</span>
<span class="va">yvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">igm</span><span class="op">$</span><span class="va">lcfincome</span>, <span class="fl">.05</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">igm</span><span class="op">$</span><span class="va">lcfincome</span>, <span class="fl">.95</span><span class="op">)</span>, length.out<span class="op">=</span><span class="fl">50</span><span class="op">)</span>
<span class="co">## This line doesn't adjust for any covariates</span>
<span class="va">obs.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cfa.html">cfa</a></span><span class="op">(</span><span class="va">lcfincome</span> <span class="op">~</span> <span class="va">lfincome</span>, tvals<span class="op">=</span><span class="va">tvals</span>, yvals<span class="op">=</span><span class="va">yvals</span>, data<span class="op">=</span><span class="va">igm</span>, iters<span class="op">=</span><span class="fl">25</span><span class="op">)</span>
<span class="co">#&gt; boostrapping standard errors...</span>

<span class="co">## This line adjusts for differences in education</span>
<span class="va">cf.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cfa.html">cfa</a></span><span class="op">(</span><span class="va">lcfincome</span> <span class="op">~</span> <span class="va">lfincome</span>, <span class="op">~</span><span class="va">HEDUC</span>, tvals<span class="op">=</span><span class="va">tvals</span>, yvals<span class="op">=</span><span class="va">yvals</span>, data<span class="op">=</span><span class="va">igm</span>, iters<span class="op">=</span><span class="fl">25</span><span class="op">)</span>
<span class="co">#&gt; boostrapping standard errors...</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">cf.dist</span><span class="op">)</span>
<span class="co">#&gt; [1] "CFA"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span><span class="op">(</span><span class="va">cf.dist</span><span class="op">)</span>
<span class="co">#&gt; $names</span>
<span class="co">#&gt; [1] "tvals"        "distcondt"    "bootiterlist" "tvallist"    </span>
<span class="co">#&gt; [5] "coef"        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] "CFA"</span></code></pre></div>
<p>The objects that are returned from the <code>cfa</code> method are (most of the time) too complicated to directly understand, as they are distribution function for every value of <span class="math inline"><em>t</em></span>. Instead, the <code>getRes.CFA</code> method can be used to obtain particular results from a CFA object. Here is an example</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cf.e</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/getRes.CFA.html">getRes.CFA</a></span><span class="op">(</span><span class="va">cf.dist</span>, fun<span class="op">=</span><span class="va">E</span>, se<span class="op">=</span><span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>The parameter <code>fun</code> in the <code>getRes.CFA</code> function accepts any function that can be applied to a distribution function and return a single number (additional parameters that the function needs can be passed through the <code>...</code> argument). In the example above, <code>E</code> is computes the expectation given a distribution function – this function is supplied in the package. Besides <code>E</code>, functions for computing the variance, inter-quantile range, the fraction of individuals below the poverty line, and the fraction of individuals who are “rich” – these are called <code>Var</code>, <code>IQR</code>, <code>pov</code>, and <code>rich</code>. But other custom functions could be developed by users.</p>
<p>These types of results are simple to plot as function of <span class="math inline"><em>t</em></span>. The <code>ccfa</code> packages implements plotting mechanisms using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/ggplot2.CFA.html">ggplot2.CFA</a></span><span class="op">(</span><span class="va">cf.e</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png"></p>
<p>Next, we include an example where quantile regression is used in the first step to estimate the conditional conditional distribution. The following code estimates two counterfactual distributions using first-step quantile regression. The first one does not include any covariates (so the counterfactual distribution is the observed distribution); the second includes the head of the household’s education as a covariate.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.r-project.org">quantreg</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: SparseM</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'SparseM'</span>
<span class="co">#&gt; The following object is masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     backsolve</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cfa2.html">cfa2</a></span><span class="op">(</span><span class="va">lcfincome</span> <span class="op">~</span> <span class="va">lfincome</span>, <span class="va">tvals</span>, <span class="va">yvals</span>, <span class="va">igm</span>, method1<span class="op">=</span><span class="st">"qr"</span>, xformla2<span class="op">=</span><span class="op">~</span><span class="va">HEDUC</span>, method2<span class="op">=</span><span class="st">"qr"</span>, iters<span class="op">=</span><span class="fl">25</span>, tau1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">.05</span>,<span class="fl">.95</span>,<span class="fl">.05</span><span class="op">)</span>, tau2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">.05</span>,<span class="fl">.95</span>,<span class="fl">.05</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; boostrapping standard errors...</span></code></pre></div>
<p>Joint estimation allows one to test if the results are the same whether or not covariates are included. To do this we can run the following code which produces uniform confidence bands on the difference between the two sets of results. Because the bands are uniform, one can reject that child’s income depends on parents’ income if the result is statistically different from 0 anywhere.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/ggplot2.CFA.html">ggplot2.CFA</a></span><span class="op">(</span><span class="fu"><a href="reference/getResDiff.CFA.html">getResDiff.CFA</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cfa1</span>, <span class="va">out</span><span class="op">$</span><span class="va">cfa2</span>, <span class="va">E</span><span class="op">)</span>, setype<span class="op">=</span><span class="st">"uniform"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-plotdiff-1.png"></p>
<p>As another example, we can test if the variance of child’s income changes with parents’ income. The following code plots uniform confidence bands for the difference between the variance of child’s income conditional on parent’s income and the average variance (averaged over parent’s income).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/ggplot2.CFA.html">ggplot2.CFA</a></span><span class="op">(</span><span class="fu"><a href="reference/test.CFA.html">test.CFA</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">cfa1</span>, <span class="va">Var</span>, <span class="va">igm</span><span class="op">$</span><span class="va">lfincome</span><span class="op">)</span>, setype<span class="op">=</span><span class="st">"uniform"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-plottest-1.png"></p>
<p>As a final example, we show how to compute counterfactual distributions using local linear regression. The computation is a bit slower, so we do not plot standard errors here.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">llres</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cfa.html">cfa</a></span><span class="op">(</span><span class="va">lcfincome</span> <span class="op">~</span> <span class="va">lfincome</span>, <span class="op">~</span><span class="va">HEDUC</span>, tvals<span class="op">=</span><span class="va">tvals</span>, yvals<span class="op">=</span><span class="va">yvals</span>, method<span class="op">=</span><span class="st">"ll"</span>, se<span class="op">=</span><span class="cn">FALSE</span>, data<span class="op">=</span><span class="va">igm</span><span class="op">)</span>
<span class="co">#&gt; [1] "computing local linear distribution regression"</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/ggplot2.CFA.html">ggplot2.CFA</a></span><span class="op">(</span><span class="fu"><a href="reference/getRes.CFA.html">getRes.CFA</a></span><span class="op">(</span><span class="va">llres</span>, <span class="va">E</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-plotll-1.png"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=ccfa">https://​cloud.r-project.org/​package=ccfa</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Weige Huang <br><small class="roles"> Author, maintainer </small>  </li>
<li>Brantly Callaway <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Weige Huang, Brantly Callaway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
